# Content Mutation

This folder contains the code for the content mutation experiment in Section 3. The content mutation experiment involves finding the third parties on a site that are classified as ATS (Ad and Tracking Service) by the classifier, and randomizing their URL. Please read the paper for more details. To run this task, please run the following script with relevant arguments (example below):

```
python content_mutation.py
```
> The arguments accepted by this script:
>
> - `--graph`: the path to the `graph.csv` file generated by the WebGraph graph creation process.
> - `--out`: the path to the output graph CSV file.
> - `--predictions`: the path to a prediction file generated by the WebGraph classification process (these are the files labelled `tp_0`, `tp_1`, etc). They contain the truth and predicted values. 
> - `--mapping`: the path to the output directory of domain mappings.
> - `--changetp`:  a boolean flag to determine whether third party URLs should be changed to first party subdomains. Default is False. 

Example script run:
```
python content_mutation.py --graph graph.csv --out outgraph.csv --predictions tp_0 --mapping mapping_folder --changetp True
```
### Pipeline

The pipeline performs the following tasks:

1. Reads the input graph file.
2. Finds the third party nodes in the graph.
3. Reads the input predictions file to get all third party nodes classified as ATS by the classifier.
4. For the predicted third party ATS nodes, perform content mutation of their URLs. This mutation consists of randomizing the domain or URL parameters (or both). If `--changetp` is set to True, the randomization occurs with the constraint that the third party domain should also be a subdomain of the first party. 
5. Creates a new graph file that contains all the nodes and edges as the original graph, but all third party ATS node URLs are replaced with the mutation URLs. 